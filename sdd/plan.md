# CommuteMate 백엔드 구현 계획서

> **작성일**: 2025-01-08
> **기준 문서**: `docs/pm.md` (출근부 앱 기획서)
> **분석 대상**: CommuteMate-backend 코드베이스

---

## 📊 구현 현황 요약

> 🔍 **전체 검토 완료**: 2026-01-11
> - **Phase 1 (사용자 기능)**: 출퇴근 인증(QR), 홈 화면, 근무 이력, 마이페이지 구현 완료 ✨
> - **Phase 2 (관리자 기능)**: 관리자 스케줄 관리, 신청 승인, 근무 시간/이력 조회 구현 완료 ✨
> - **WebSocket**: 실시간 알림 기능 구현 완료
> - **검증 로직**: 27시간/13시간/2시간 규칙 및 삭제 제외 처리 완료

| 분류 | 전체 기능 수 | 완료 | 미착수 | 완료율 |
|------|-------------|------|--------|--------|
| **사용자 화면** | 6 | 6 | 0 | **100%** ✅ |
| **관리자 화면** | 7 | 7 | 0 | **100%** ✅ |
| **기반 기능** | 1 | 1 | 0 | **100%** ✅ |
| **향후 계획** | 1 | 0 | 1 | 0% |
| **전체** | 15 | 14 | 1 | **93%** ✨ |

> ✅ **주요 완료 항목**: 출퇴근 인증(QR), 홈/마이페이지, 이력 조회, 관리자 통계 등 핵심 기능 전체 구현 완료

---

## 🔍 핵심 검토 결과 (2026-01-11)

### 주요 발견사항

1. **Phase 1 (사용자 기능) 구현 완료**
   - ✅ **출퇴근 인증**: QR 토큰 발급(관리자), 출근/퇴근 체크(사용자) 구현 (`WorkAttendanceController`)
   - ✅ **홈 화면**: 근무 시간/스케줄 상태에 따른 UI 상태 응답 구현 (`HomeController`)
   - ✅ **근무 이력**: 실제 근무 시간 포함한 이력 조회 구현 (`WorkScheduleController`)
   - ✅ **마이페이지**: 주간/월간 근무 시간 통계 구현 (`UserController`)

2. **Phase 2 (관리자 기능) 구현 완료**
   - ✅ **근무 시간/이력 조회**: 사용자별/전체 근무 시간 통계 및 이력 조회 API 구현 (`AdminScheduleController`)
   - ✅ **신청/변경 관리**: 신청 승인, 변경 요청 승인/거부 로직 및 알림 구현

3. **기반 기능 및 검증**
   - ✅ **WebSocket**: 실시간 알림 브로드캐스트 (`ScheduleUpdateMessage`, `NotificationMessage`)
   - ✅ **비즈니스 규칙**: 27시간/13시간/2시간 검증, 신청 기간 제한 등 (`ScheduleValidator`)

---

---

## ✅ 1. 구현 완료된 기능 (pm.md 기준)

### 1.1 근무 시간 신청 (사용자)
**상태**: ✅ **완료** (pm.md 1.3.1)

### 1.2 근무 시간 변경 (사용자)
**상태**: ✅ **완료** (pm.md 1.3.2)

### 1.3 관리자 - 월별 스케줄 제한 관리
**상태**: ✅ **완료** (pm.md 2.3)

### 1.4 관리자 - 신청 기간 설정
**상태**: ✅ **완료** (pm.md 2.3)

### 1.5 관리자 - 변경 요청 처리
**상태**: ✅ **완료** (pm.md 2.3)

### 1.6 관리자 - 신청 승인
**상태**: ✅ **완료** (pm.md 2.8)

### 1.7 WebSocket 실시간 알림
**상태**: ✅ **완료**

### 2.1 홈 화면 (사용자)
**상태**: ✅ **완료** (pm.md 1.1)
- `GET /api/v1/home/work-time`: 오늘 근무 시간 및 스케줄 수 조회
- `GET /api/v1/home/attendance-status`: 출퇴근 버튼 상태 조회

### 2.2 출퇴근 인증 (사용자 & 관리자 태블릿)
**상태**: ✅ **완료** (pm.md 1.2)
- `GET /api/v1/attendance/qr-token`: 관리자용 QR 토큰 발급
- `POST /api/v1/attendance/check-in`: QR 토큰 기반 출근 체크
- `POST /api/v1/attendance/check-out`: 퇴근 체크
- `GET /api/v1/attendance/today`, `/history`: 출퇴근 이력 조회

### 2.3 근무 이력 조회 (사용자)
**상태**: ✅ **완료** (pm.md 1.3.3)
- `GET /api/v1/work-schedules/history`: 월별 근무 이력 및 실제 근무 시간 조회

### 2.4 마이페이지 (사용자)
**상태**: ✅ **완료** (pm.md 1.4)
- `GET /api/v1/users/me`: 내 정보 조회
- `GET /api/v1/users/me/work-time/weekly`: 주간 근무 시간 통계
- `GET /api/v1/users/me/work-time/monthly`: 월간 근무 시간 통계

### 2.5 관리자 홈 화면 / 통계
**상태**: ✅ **완료** (pm.md 2.1)
- `GET /api/v1/admin/schedule/work-time/summary`: 전체 근무 시간 통계 (대시보드용)

### 2.6 관리자 - 근무 시간 확인
**상태**: ✅ **완료** (pm.md 2.3.1)
- `GET /api/v1/admin/schedule/work-time`: 사용자별 월별 근무 시간 조회

### 2.7 관리자 - 근무 이력 확인
**상태**: ✅ **완료** (pm.md 2.3.2)
- `GET /api/v1/admin/schedule/history`: 사용자별 근무 이력 조회
- `GET /api/v1/admin/schedule/history/all`: 전체 근무 이력 조회

---

## 🚧 2. 미구현 기능 (pm.md 기준)

### 3.1 근무 시간 출력 기능 (향후 계획)
**상태**: ❌ **미착수** (Phase 4)
**예상 API**:
```
GET /api/v1/work-schedules/export?userId={userId}&year={year}&month={month}&format={format}
```

---

## 📝 6. 검토 필요 사항 (pm.md 4)

### 6.1 근무 시간 계산 정책
**현황**:
- 조기 출근/늦은 퇴근 미반영
- 지각/조퇴는 1분 단위 반영

**검토 필요**:
- 정책 최종 확인 필요
- 관련 비즈니스 로직 구현 시 명확한 요구사항 정의 필요

---

### 6.2 이력 조회 상세도
**현황**:
- 근무 이력 조회 API 미구현

**검토 필요**:
- 요약 정보만 제공할지, 상세 정보까지 제공할지 결정 필요
- 페이징 처리 여부 결정 필요

---

## 🏁 7. 결론

### 현재 구현 상태 (담당 범위)
- ✅ **근무 일정 관리**: 완료 (신청, 변경 요청, 조회, 검증)
- ✅ **관리자 스케줄 관리**: 완료 (제한/기간 설정, 승인/거부, 변경 승인)
- ✅ **WebSocket**: 완료 (실시간 알림)
- ✅ **출퇴근 인증**: 완료 (QR 인증, 출퇴근 체크)
- ✅ **홈 화면**: 완료 (근무 시간, 출퇴근 상태)
- ✅ **근무 이력**: 완료 (사용자/관리자 조회)
- ✅ **마이페이지**: 완료 (근무 시간 통계)

### 논리적 검토 결과

**✅ 올바르게 구현된 로직**:
- **스케줄링**: 27/13/2시간 규칙, 신청 기간 제한, 동시 근무자 제한
- **출퇴근**: QR 토큰 생성/검증, 스케줄 기반 출퇴근 가능 시간 체크 (시작-10분 ~ 종료+1시간)
- **근무 시간 계산**: 실제 출퇴근 기록 기반, 스케줄 시간 범위 내 클램핑 처리
- **이력 조회**: 취소/삭제된 일정 제외, 실제 근무 시간 포함하여 반환

**✅ 해결된 문제점**:
- ~~비즈니스 규칙 위반 가능성~~ → **해결됨** (Validator)
- ~~사용자가 본인 일정 조회 불가~~ → **해결됨**
- ~~관리자 신청 승인 불가~~ → **해결됨**
- ~~실시간 알림 기능 없음~~ → **해결됨**
- ~~출퇴근 인증 수단 부재~~ → **해결됨** (QR)

### 다음 단계
1. **Phase 1~2 완료**: 모든 핵심 기능 구현됨
2. **Phase 4**: 근무 시간 출력 (Excel/PDF) 기능 구현 필요 (추후)

### 전체 예상 공수
- **진행률**: **93%** (14/15 기능 완료)
- **잔여**: Phase 4 (향후 계획) 1건

---

**문서 작성**: Claude Code
**마지막 업데이트**: 2026-01-11 - Phase 1, 2 전체 구현 완료
